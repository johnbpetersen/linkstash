# ADR-003: Metadata Extraction Strategy — Cascade Approach

**Status:** Accepted
**Date:** 2026-02-03

## Context

LinkStash must extract metadata from different sources:
- **Twitter/X links**: Use fxtwitter.com API (returns structured JSON with tweet text, author, media)
- **Other URLs**: Fetch HTML and extract og:tags (title, description, image, author)
- **Failures**: Save link with URL as title, empty description

We need a consistent strategy for handling all three cases.

## Decision

Implement a **cascade approach**:

1. If URL is Twitter/X link → fetch from `fxtwitter.com` API endpoint
2. Else → fetch URL, parse HTML for og:tags, fall back to `<title>` tag
3. If fetch fails (timeout, 404, blocked) → save with minimal metadata (URL as title, empty description)

## Alternatives Considered

1. **Always use fxtwitter for everything**: Only works for Twitter; not applicable
2. **Try multiple metadata sources in sequence**: Would add complexity and latency; cascade simpler
3. **Require user to provide metadata manually**: Violates zero-effort principle

## Consequences

- ✅ Handles Twitter natively with rich metadata
- ✅ Works for any public URL with og:tags
- ✅ Graceful degradation when metadata unavailable
- ✅ No AI/semantic extraction — deterministic only
- ❌ Relies on og:tags being present (some sites don't have them)
- ❌ fxtwitter API availability is external dependency
- ⚠️ Some sites may block fetches (return 403/429)

## Notes

In future v2, could add:
- Retry logic with exponential backoff
- User-agent rotation to avoid blocks
- Manual override to edit metadata after import
- Scheduled link health checks

For v1, keep it simple: one pass through each URL, best-effort extraction.
